# Архитектура Экосистемы "Тёплый Дом"
## Описание Компании
"Тёплый дом" — небольшая компания, специализирующаяся на организации удалённого управления отоплением в домах. Недавно компания выиграла тендер на создание экосистемы умных посёлков в нескольких регионах страны. Для выполнения этого заказа необходимо расширить функционал системы и масштабировать её.

## Задание 1. Анализ и планирование

### 1.1 Изучение функциональности монолитного приложения

На текущем этапе система состоит из следующих основных компонентов, каждый из которых отвечает за свою часть функциональности:

* Датчик температуры:
  - Измеряет температуру в реальном времени и предоставляет данные системе.
  - Может быть включён или выключен по запросу.
    
* Модуль управления отоплением:
  - Получает данные о текущей температуре от подключённых датчиков.
  - Позволяет пользователю задавать целевую температуру для отопительных устройств.
  - Взаимодействует с умными устройствами отопления и передаёт команды для их настройки. 
* Умное устройство отопления:
  - Получает указания от модуля управления и регулирует температуру в помещении.
  - Устанавливает и поддерживает целевую температуру.
  - Может быть включено или выключено в зависимости от потребностей.

Система взаимодействует с двумя типами пользователей:
 - Мастер: устанавливает и настраивает оборудование. 
    Пользователь приобретает устройство, приглашает мастера, который приезжает, настраивает устройство и вносит его идентификатор в базу данных системы.
 - Пользователь (владелец дома): управляет устройством через мобильное приложение. Команды пользователя поступают на центральный модуль управления, который передаёт их датчику и отопительному устройству для исполнения.

Этот процесс достаточно трудоёмок и предполагает множество ручных операций, что значительно усложняет масштабирование системы.


### 1.2 Анализ архитектуры монолитного приложения

Монолитная архитектура системы создаёт значительные ограничения, которые мешают развитию и масштабированию.

Текущие характеристики системы:

- Язык программирования: Java
- База данных: PostgreSQL

Архитектура: Монолитная - все компоненты системы (обработка запросов, бизнес-логика, работа с данными) находятся в рамках одного приложения.

Взаимодействие: Синхронное - запросы обрабатываются последовательно.

Масштабируемость: Ограничена, так как монолит сложно масштабировать по частям.

Развёртывание: Требует остановки всего приложения.


### 1.3 Определение доменов и границ контекстов

Для построения новой архитектуры с использованием принципов Domain-Driven Design (DDD), необходимо определить домены и границы контекстов:

Основные домены
- Управление устройствами:
  * Включает все функции, связанные с отправкой команд на умные устройства отопления и их управлением.
  * Основная цель: управление состоянием умных устройств (включение, выключение, регулировка температуры).

- Мониторинг и сбор данных
  * Включает сбор данных о температуре с датчиков и передачу их в центральную систему для анализа.
  * Основная цель: обеспечить пользователей актуальной информацией о температуре в доме.

- Настройка и подключение устройств
  * Включает процесс установки и первичной настройки новых устройств в системе.
  * Основная цель: автоматизировать процесс регистрации и настройки новых устройств без участия специалистов.

- Пользовательский интерфейс
  * Включает взаимодействие с пользователем через мобильное приложение и веб-интерфейс.
  * Основная цель: предоставление пользователям интерфейса для управления системой и просмотра данных.

Границы контекстов: 

- Контекст управления устройствами: Включает в себя функциональность для управления умными устройствами и взаимодействия с ними.
- Контекст мониторинга: Включает сбор и обработку данных с датчиков, а также предоставление актуальной информации пользователям.
- Контекст настройки и подключения: Включает процессы первичной регистрации и настройки устройств, а также взаимодействие с базой данных для их регистрации.
- Контекст взаимодействия с пользователем: Включает все аспекты пользовательского взаимодействия через мобильные и веб-приложения.


### 1.4 Анализ архитектуры монолитного приложения в контексте бизнес-задач компании

Монолитная архитектура системы создаёт значительные ограничения, которые мешают развитию и достижению бизнес-целей компании. Ниже представлен анализ существующих проблем:

#### Основные проблемы монолитного решения

1. Сложность масштабирования: 

    - Рост нагрузки: С увеличением числа пользователей растёт нагрузка на центральный сервер, что приводит к снижению производительности и создаёт узкое место в архитектуре.
    - Отсутствие изолированного масштабирования: Масштабирование отдельных функций, таких как обработка данных с датчиков, невозможно без изменения всей системы. Это делает процесс масштабирования дорогим и неэффективным.

2. Ограниченная гибкость при добавлении новых функций

    - Расширение функционала: Текущая система поддерживает только управление отоплением и мониторинг температуры. Добавление новых устройств, таких как освещение или камеры безопасности, потребует значительных изменений в архитектуре.
    
    - Замедление выхода на рынок: Ограниченная гибкость замедляет развитие продукта и ограничивает возможности компании для выхода на новые рынки с новыми функциями.

3. Зависимость от технических специалистов

    - Подключение новых устройств: Процесс подключения новых устройств требует участия технического специалиста, что увеличивает затраты компании и снижает возможности по расширению клиентской базы.
    
    - Ручная регистрация: Ручная регистрация устройств специалистом замедляет подключение новых домов к системе, что является узким местом в бизнес-процессе компании.

4. Проблемы развёртывания и обновлений

    - Полная остановка системы: Любое обновление требует полной остановки системы, что ведёт к простоям и неудобствам для пользователей.
    
    - Отсутствие непрерывного развёртывания: Отсутствие поддержки непрерывного развёртывания усложняет внедрение новых функций и исправление ошибок, что ограничивает скорость реагирования компании на запросы рынка.

#### Рекомендации по улучшению

1. Переход на микросервисную архитектуру: Для улучшения масштабируемости и гибкости рекомендуется декомпозировать систему на микросервисы, каждый из которых будет отвечать за определённый домен (например, управление устройствами, мониторинг и сбор данных, настройка и подключение).

1. Автоматизация подключения устройств: Разработка API для автоматического подключения новых устройств без участия специалистов позволит существенно сократить затраты и увеличить скорость подключения клиентов.

1. Внедрение асинхронного взаимодействия: Использование асинхронных методов обмена данными (например, с помощью очередей сообщений) позволит повысить производительность системы и улучшить пользовательский опыт.

### 1.5 Диаграмма контекста
Диаграмма контекста монолитной системы представлена на диаграмме [as_is diagram](diagrams/context/as_is.puml)
